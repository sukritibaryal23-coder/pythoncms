{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <div class="d-flex justify-content-end">
        <a href="{% url 'mediamgmt:media_list' %}?media_type=video"
           class="btn btn-primary">Back</a>
    </div>

    <h1>{% if media %}Edit Video{% else %}Add Video{% endif %}</h1>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Title -->
        <div class="mb-3">
            <label class="form-label">Title</label>
            {{ form.title }}
        </div>

        <!-- Video Source -->
        <div class="mb-3">
            <label class="form-label">Video Source</label>
            {{ form.video_source }}
        </div>

        <!-- Local Video Upload -->
        <div class="mb-3" id="local-video-container">
            <label class="form-label">Upload Video</label>
            <input type="file"
                   name="file"
                   accept="video/*"
                   class="form-control">
        </div>

        <!-- YouTube URL -->
        <div class="mb-3" id="youtube-container" style="display:none;">
            <label class="form-label">YouTube URL</label>
            {{ form.youtube_url }}
            <small class="text-muted">Example: https://www.youtube.com/watch?v=xxxxx</small>
        </div>

        <!-- Caption -->
        <div class="mb-3">
            <label class="form-label">Caption</label>
            {{ form.caption }}
        </div>

        <!-- Status -->
        <div class="mb-3 form-check">
            {{ form.is_active }}
            <label class="form-check-label">Published</label>
        </div>

        <!-- Actions -->
        <div class="mt-3">
            <button name="action" value="save" class="btn btn-success">Save</button>
            <button name="action" value="save_more" class="btn btn-secondary">Save & Continue</button>
            <button name="action" value="save_quit" class="btn btn-primary">Save & Quit</button>
        </div>

    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const sourceSelect = document.getElementById("id_video_source");
    const localContainer = document.getElementById("local-video-container");
    const youtubeContainer = document.getElementById("youtube-container");

    function toggleSource() {
        if (sourceSelect.value === "youtube") {
            youtubeContainer.style.display = "block";
            localContainer.style.display = "none";
        } else {
            youtubeContainer.style.display = "none";
            localContainer.style.display = "block";
        }
    }

    sourceSelect.addEventListener("change", toggleSource);
    toggleSource(); // initial
});
</script>

{% endblock %}
