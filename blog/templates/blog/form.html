{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="d-flex justify-content-end position-sticky mt-2" style="top: 50px; z-index: 1020;">
    <a href="{% url 'blog_list' %}" class="btn btn-primary">
        Back
    </a>
</div>
<h3>
    {% if form.instance.pk %}
        Edit {{ form.instance.title }}<small style="font-size: 0.5em; color: gray; margin-left: 5px;">{% if homepage %} Homepage Blog{% else %} Inner Page Blog{% endif %} </small>
    {% else %}
        Add New <small style="font-size: 0.5em; color: gray; margin-left: 5px;">{% if homepage %} Homepage Blog{% else %} Inner Page Blog{% endif %} </small>
    {% endif %}
    </h3>

    {{ form.media }}
    <form method="post">
        <input type="hidden" id="blog-id" value="{{ form.instance.pk|default:'' }}">
        {% csrf_token %}
           {{ form.title.label_tag }}<br>
            {{ form.title }}
            <br><br>
            
            {{ form.subtitle.label_tag }}<br>
            {{ form.subtitle }}<br><br>

            {{ form.slug.label_tag }}<br>
            {{ form.slug }}
            <span id="slug-warning" style="color:red; display:none;">
                Slug already exists!
            </span>
            <br><br>

           {{ form.content.label_tag }}<br>
{{ form.content }}<br>
<button type="button" id="add-readmore" class="btn btn-secondary mb-2">
    Read More
</button><br>

<!-- CKEditor 4 CDN -->
<script src="https://cdn.ckeditor.com/4.21.0/standard/ckeditor.js"></script>

<style>
hr.readmore {
    border: none;
    border-top: 2px dashed #333;
    margin: 20px 0;
}
</style>

<script>
    // Initialize CKEditor
    var editor = CKEDITOR.replace('{{ form.content.id_for_label }}');

    // Handle external Read More button
    document.getElementById('add-readmore').addEventListener('click', function() {
        var data = editor.getData();

        // Check for unique marker
        if (data.indexOf('data-readmore="true"') !== -1) {
            alert('Only one Read More line is allowed!');
            return;
        }

        // Insert unique stylised readmore line
        editor.insertHtml('<hr class="readmore" data-readmore="true">');
    });
</script>


            <style>
            hr.readmore {
                border: none;
                border-top: 2px dashed #333;
                margin: 20px 0;
            }
            </style>

            

            {{ form.active.label_tag }}
            {{ form.active }}<br><br>
            
            <input type="hidden" name="metadata_opened" id="metadata_opened" value="0">

<input type="hidden" name="metadata_opened" id="metadata_opened" value="0">

<button class="btn btn-secondary mb-3 d-flex justify-content-between align-items-center"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#metadata-section"
        aria-expanded="false">
    Metadata
    <i class="bi bi-chevron-down ms-2"></i>
</button>

<div class="collapse" id="metadata-section">
    <div class="card card-body">
        <div class="mb-3">
            {{ form.meta_title.label_tag }}<br>
            {{ form.meta_title }}
            <small class="text-muted">
                <span id="title-left">60</span> characters left
            </small>
        </div>

        <div class="mb-3">
            {{ form.meta_keywords.label_tag }}<br>
            {{ form.meta_keywords }}
            <small class="text-muted">
                <span id="keywords-left">250</span> characters left
            </small>
        </div>

        <div class="mb-3">
            {{ form.meta_description.label_tag }}<br>
            {{ form.meta_description }}
            <small class="text-muted">
                <span id="description-left">160</span> characters left
            </small>
        </div>
    </div>
</div>


        <div>
        <button type="submit" name="action" value="save" class="btn btn-success">Save</button>
        <button type="submit" name="action" value="save_more" class="btn btn-success">Save & More</button>
        <button type="submit" name="action" value="save_quit" class="btn btn-success">Save & Quit</button>

    </div>
    </form>

<!-- External blog.js (optional, after DOM ready) -->
<script src="{% static 'js/blogform.js' %}"></script>
{% endblock %}